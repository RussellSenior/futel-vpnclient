Build:

have client.crt client.key

  git clone https://git.lede-project.org/source.git build
  cp -r files build
  cp client.crt client.key build/files/etc/openvpn/keys
  cp config-stub build/.config
  cd build
  make defconfig
  time make -j2 BUILD_LOG=1 IGNORE_ERRORS=m V=s  # for 2 cores

built images are in bin/targets/ar71xx/generic/
for the Ubiquiti AirRouter, the images are lede-ar71xx-generic-ubnt-airrouter-squashfs-*.bin


Install to Ubiquiti AirRouter with lede already installed:

find routers IP address with "ip a"

copy sysupgrade image to router running lede:
  scp bin/targets/ar71xx/generic/lede-ar71xx-generic-ubnt-airrouter-squashfs-sysupgrade.bin root@192.168.1.1:/tmp
flash sysupgrade image
  ssh root@192.168.1.1
  sysupgrade -v -n /tmp/lede-ar71xx-generic-ubnt-airrouter-squashfs-sysupgrade.bin
wait for router to reboot

copy factory image to ubiquiti airrouter running factory:
$ tftp 192.168.1.20
tftp> mode binary
tftp> put XM-v5.5.2.build14175.bin flash_update
Sent 6736122 bytes in 9.4 seconds
tftp> quit
power cycle router


change password on router
  ssh root:test@192.168.1.1
  passwd

edit /etc/config/network on router for address unique in local network e.g.
  config interface 'lan'
    ...
    option ipaddr '192.168.8.1'

alternative: edit /etc/resolv.conf to use google dns, and protect
  rm /etc/resolv.conf
  echo "search lan" >> /etc/resolv.conf
  echo "nameserver 8.8.8.8" >> /etc/resolv.conf
  echo "nameserver 4.4.4.4" >> /etc/resolv.conf
alternative: edit /etc/resolv.conf to use upstream dns, and protect
  rm /etc/resolv.conf
  echo "search lan" >> /etc/resolv.conf
  echo "nameserver 127.0.0.1" >> /etc/resolv.conf


reboot router

Notes:

sysupgrade firmware:
https://lede-project.org/docs/user-guide/sysupgrade.cli
https://lede-project.org/docs/guide-quick-start/sysupgrade.luci
factory firmware:
https://wiki.openwrt.org/toh/ubiquiti/airrouter

The sysupgrade image is used if openwrt or lede is already on the router. Otherwise the factory image is used.
Use the -n argument to erase any exisiting config.

Replace passwd step with copying shadow to build/files/etc/shadow
Replace ip address step with copying network to build/files/etc/config/network?
Replace nameserver step with copying resolv.conf to build/files/etc/resolv.conf? Or network? Or dhcp?

The wifi is disabled by default.  You can only ssh in from a LAN port.  The LAN network
is 192.168.1.0/24 by default.
